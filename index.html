<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>অর্ডার ডাটা ম্যানেজার — আপডেটেড</title>
  <meta name="description" content="নাম, ফোন, বিদ্যালয়, আইডি, অর্ডারের নাম, টাকা — সংরক্ষণ, দেখা, এডিট, ডিলিট, সার্চ, এক্সপোর্ট/ইম্পোর্ট।"> 
  <link rel="stylesheet" href="style.css" />
  <!-- Socket.IO client (CDN) -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <!-- লগইন মোডাল -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <h2>লগইন করুন</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="userName">নাম</label>
          <input type="text" id="userName" placeholder="আপনার নাম লিখুন" required />
        </div>
        <div class="form-group">
          <label for="userPassword">পাসওয়ার্ড</label>
          <input type="password" id="userPassword" placeholder="পাসওয়ার্ড লিখুন" required />
        </div>
        <button type="submit" class="btn btn-primary">লগইন</button>
      </form>
    </div>
  </div>

  <!-- অর্ডার ব্লক মেসেজ -->
  <div id="orderBlockMessage" class="order-block-message">
    <div class="block-message-content">
      <h2>⏰ অর্ডার করার টাইম শেষ!</h2>
      <p>দুঃখিত, এই মুহূর্তে নতুন অর্ডার গ্রহণ করা হচ্ছে না।</p>
    </div>
  </div>

  <div class="container" id="mainContent" style="display: none;">
    <header>
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24"><path d="M12 3l8.66 5v8L12 21l-8.66-5V8L12 3zm0 2.2L5.5 9v6L12 18.8 18.5 15V9L12 5.2zM9 10h6v2H9v-2zm0 3h4v2H9v-2z"/></svg>
      </div>
      <div>
        <h1>অর্ডার ডাটা ম্যানেজার</h1>
        <div class="muted">নতুন: তারিখ ও বিদ্যালয় দ্বারা সার্চ, লগইন সিস্টেম, রিয়েল-টাইম ব্যবহারকারী</div>
      </div>
      <div class="spacer"></div>
      
      <!-- অনলাইন ইউজার কাউন্টার -->
      <div class="user-counter-container">
        <span class="badge brand-grad" id="connectedUsersCount">0 অনলাইন</span>
        <div class="user-list-dropdown" id="userListDropdown">
          <div class="user-list-content" id="userListContent">
            <!-- ইউজার লিস্ট এখানে দেখাবে -->
          </div>
        </div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: FORM CARD -->
      <section class="card" aria-labelledby="formTitle">
        <div class="card-header">
          <strong id="formTitle">নতুন / আপডেট অর্ডার</strong>
          <button class="btn btn-ghost" id="btnClearForm" type="button" title="ফর্ম ক্লিয়ার">
            <svg viewBox="0 0 24 24"><path d="M3 6h18v2H3V6zm2 4h14l-1.5 9.5a2 2 0 0 1-2 1.5H8.5a2 2 0 0 1-2-1.5L5 10zm5-7h4v2h-4V3z"/></svg>
            ক্লিয়ার
          </button>
        </div>
        <div class="card-body">
          <form id="orderForm" autocomplete="off">
            <input type="hidden" id="editingIndex" value="" />

            <div class="row">
              <div>
                <label for="name">নাম</label>
                <input type="text" id="name" placeholder="উদাহরণ: রাজু হাসান" required />
              </div>
              <div>
                <label for="orderId">আইডি নম্বর</label>
                <input type="text" id="orderId" placeholder="উদাহরণ: YY-2025-0001" required />
                <div class="help">ইচ্ছা করলে <em>Auto ID</em> দিয়ে আইডি জেনারেট করতে পারো।</div>
              </div>
            </div>

            <div class="row">
              <div>
                <label for="orderName">অর্ডারের নাম</label>
                <input type="text" id="orderName" placeholder="উদাহরণ: বই/পেন/টিফিন" required />
              </div>
              <div>
                <label for="amount">টাকা (৳)</label>
                <input type="number" id="amount" placeholder="উদাহরণ: 500" min="0" step="0.01" required />
              </div>
            </div>

            <div class="row" style="margin-top:6px;">
              <div>
                <label for="phone">ফোন নাম্বার</label>
                <input type="text" id="phone" placeholder="উদাহরণ: 017XXXXXXXX" required />
              </div>
              <div>
                <label for="school">বিদ্যালয়ের নাম</label>
                <input type="text" id="school" placeholder="উদাহরণ: ঢাকা কলেজ" required />
              </div>
            </div>

            <div class="help" id="orderPreview" style="margin-top:10px;"></div>

            <div class="btns">
              <button class="btn btn-primary" type="submit" id="btnSave">
                <svg viewBox="0 0 24 24"><path d="M5 5h14v14H5V5zm2 2v10h10V7H7zm2 2h6v2H9V9z"/></svg>
                সংরক্ষণ
              </button>
              <button class="btn btn-success" type="button" id="btnAutoId">
                <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20zm1 5v5l4 2-.9 1.8L11 13V7h2z"/></svg>
                Auto ID
              </button>
              <button class="btn btn-warning" type="button" id="btnExport">
                <svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM12 3l5 5h-3v6h-4V8H7l5-5z"/></svg>
                Export CSV
              </button>
              <label class="btn btn-ghost" for="importCsv">
                <svg viewBox="0 0 24 24"><path d="M19 15v4H5v-4H3v6h18v-6h-2zM11 4v8H8l4 4 4-4h-3V4h-2z"/></svg>
                Import CSV
              </label>
              <input id="importCsv" type="file" accept=".csv" style="display:none" />
              <button class="btn btn-danger" type="button" id="btnClearAll">
                <svg viewBox="0 0 24 24"><path d="M6 7h12l-1 12H7L6 7zm3-4h6l1 3H8l1-3z"/></svg>
                সব ডাটা মুছো
              </button>
            </div>
          </form>
        </div>
      </section>

      <!-- RIGHT: TABLE CARD -->
      <section class="card" aria-labelledby="listTitle">
        <div class="card-header">
          <strong id="listTitle">অর্ডার তালিকা</strong>
          <div class="toolbar">
            <!-- তারিখ ও বিদ্যালয় সার্চ ফিল্ড -->
            <div class="search-filters">
              <input type="date" id="searchDate" placeholder="তারিখ" />
              <input type="text" id="searchSchool" placeholder="বিদ্যালয়ের নাম" />
              <button class="btn btn-info" id="btnSearchByDateSchool">
                <svg viewBox="0 0 24 24"><path d="M10 2a8 8 0 1 0 4.9 14.3l5.4 5.4 1.4-1.4-5.4-5.4A8 8 0 0 0 10 2zm0 2a6 6 0 1 1 0 12 6 6 0 0 1 0-12z"/></svg>
                সার্চ
              </button>
              <button class="btn btn-ghost" id="btnResetSearch">
                <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm2.7 12.7L12 12.4l-2.7 2.3-1.4-1.4L10.6 11 8.3 8.7l1.4-1.4L12 9.6l2.7-2.3 1.4 1.4L13.4 11l2.3 2.3-1.4 1.4z"/></svg>
                রিসেট
              </button>
            </div>
            
            <div class="spacer"></div>
            
            <!-- সাধারণ সার্চ -->
            <input type="search" id="search" placeholder="সার্চ: নাম, অর্ডারের নাম, আইডি, ফোন..." />
            <select id="pageSize">
              <option value="10">প্রতি পেজে 10</option>
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
        </div>
        <div class="card-body">
          <div class="table-wrap">
            <table id="dataTable">
              <thead>
                <tr>
                  <th data-key="idx">#</th>
                  <th data-key="name">নাম</th>
                  <th data-key="orderName">অর্ডারের নাম</th>
                  <th data-key="amount">টাকা</th>
                  <th data-key="phone">ফোন</th>
                  <th data-key="school">বিদ্যালয়</th>
                  <th data-key="orderId">আইডি নম্বর</th>
                  <th data-key="orderDateTime">অর্ডারের সময়</th>
                  <th class="hide-sm" data-key="createdAt">সংযুক্ত</th>
                  <th>অ্যাকশন</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="pagination" id="pagination"></div>
        </div>
      </section>
    </div>

    <!-- অর্ডার লক/আনলক বাটন -->
    <div class="order-lock-container">
      <button class="btn btn-warning" id="orderLockBtn">
        <svg viewBox="0 0 24 24"><path d="M12 2a5 5 0 0 1 5 5v3h2a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2V7a5 5 0 0 1 5-5zm0 2a3 3 0 0 0-3 3v3h6V7a3 3 0 0 0-3-3zm-7 8v8h14v-8H5zm7 2a1 1 0 0 1 1 1v2a1 1 0 0 1-2 0v-2a1 1 0 0 1 1-1z"/></svg>
        অর্ডার লক
      </button>
    </div>
  </div>

  <div class="toast" id="toast"></div>
  <script src="script.js"></script>
</body>
</html>